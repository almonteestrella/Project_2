<!DOCTYPE html>
<html>

<head>
  <title>{{title}}</title>
  <link rel='stylesheet' href='/stylesheets/style.css' />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  {{!-- Leaflet --}}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
    integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
    crossorigin=""></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
</head>

<body>
  {{{body}}}




  <script>

    //leaflet setup
    var mymap = L.map('mapid').setView([43.6532, -79.3832], 16);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiY2lubmFtb21lIiwiYSI6ImNrMGZxbTQ5ZjAyNzQzaXM4am90Mjg0NWkifQ.hbdP4yMD7PFsKvw-PRzVuA', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: 'your.mapbox.access.token'
    }).addTo(mymap);

    //icon
    var OneIcon = L.icon({
      iconUrl: '/images/icon-pointer.png',
      //shadowUrl: '/images/icon-shadow-pointer.png',
      iconSize: [38, 95], // size of the icon
      shadowSize: [50, 64], // size of the shadow
      iconAnchor: [22, 94], // point of the icon which will correspond to marker's location
      shadowAnchor: [4, 62],  // the same for the shadow
      popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor
    });

    //pop up
    //let latlng = L.latLng(43.6532, -79.38);  //to change to a marker location!
    //let marker = L.marker(latlng, { icon: OneIcon }).addTo(mymap);

    //to change to inspecrion history!
    //let popupContent = "hello";

    //marker.bindPopup(popupContent).openPopup();

    function addToMap(count) {
      count = count || 'all'
      $.get("/api/f/" + count, function () {
      })
        .done(function (data) {
          let items = jQuery.parseJSON(data)
          for(let key in items){
            let latlng = L.latLng(items[key].lat, items[key].lon);  //to change to a marker location!
            let marker = L.marker(latlng).addTo(mymap);
            marker.bindPopup(items[key].name);
          }
        });
    }

    addToMap(100)

  </script>


</body>

</html>